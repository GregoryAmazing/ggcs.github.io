<!DOCTYPE html>

<style>
    dd {
        white-space: pre-wrap;
    }
</style>

<script defer>
    function doNothing() {}

    function escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
    }

    function get_ajax(url, callback, type) {
        var xhr = new XMLHttpRequest();
        if (type) xhr.responseType = type;
        if (typeof callback === 'function') {
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200)
                    callback(xhr.response);
            };
        }
        xhr.open('GET', url, true);
        xhr.send();
    }

    function get_text(u, c) {
        get_ajax(u, c);
    }
    function get_json(u, c) {
        get_ajax(u, c, 'json');
    }

    var posts = [];

    function render() {
        var text = '<dl>';
        for (var i = 0; i < posts.length; i++) {
            var post = posts[i];
            text +=
                '<dt>' +
                post.name +
                '</dt>' +
                '<dd>' +
                escapeHtml(post.text || '') +
                '\n<small>' +
                JSON.stringify(post, null, 2) +
                '</small></dd><hr>';
        }
        text += '</dl>';

        document.body.innerHTML = text;
    }

    function renderBlogPost(post) {
        get_text(post.download_url, function(text) {
            post.text = text;
            render();
        });
    }

    function renderBlogPosts(_posts) {
        posts = _posts;
        for (var i = 0; i < posts.length; i++)
            if (posts[i].type === 'file') renderBlogPost(posts[i]);
    }

    get_json(
        'https://api.github.com/repos/romanovsky-g/romanovsky-g.github.io/contents/',
        renderBlogPosts
    );
</script>
